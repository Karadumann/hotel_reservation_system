<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Add Reservation</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #343a40;
            color: #fff;
        }
        .container {
            margin-top: 50px;
        }
        .btn-primary, .btn-secondary {
            background-color: #007bff;
            border-color: #007bff;
        }
        .btn-secondary {
            background-color: #6c757d;
            border-color: #6c757d;
        }
        .form-control {
            background-color: #495057;
            color: #fff;
            border: 1px solid #6c757d;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Add Reservation</h1>

    <div th:if="${successMessage}" class="alert alert-success" role="alert">
        <span th:text="${successMessage}"></span>
    </div>
    <div th:if="${errorMessage}" class="alert alert-danger" role="alert">
        <span th:text="${errorMessage}"></span>
    </div>

    <form th:action="@{/admin/addReservation}" th:object="${reservation}" method="post">
        <div class="form-group">
            <label for="clientName">Client Name:</label>
            <input type="text" class="form-control" id="clientName" th:field="*{client.name}" required />
        </div>
        <div class="form-group">
            <label for="clientSurname">Client Surname:</label>
            <input type="text" class="form-control" id="clientSurname" th:field="*{client.surname}" required />
        </div>
        <div class="form-group">
            <label for="clientTelephone">Client Telephone:</label>
            <input type="tel" class="form-control" id="clientTelephone" th:field="*{client.telephone}" required pattern="[0-9]{10}" title="Please enter a valid 10-digit phone number"/>
        </div>
        <div class="form-group">
            <label for="clientAddress">Client Address:</label>
            <input type="text" class="form-control" id="clientAddress" th:field="*{client.address}" required />
        </div>
        <div class="form-group">
            <label for="hotel">Hotel:</label>
            <select class="form-control" id="hotel" name="hotelId" th:field="*{hotel.id}" required onchange="loadRooms()">
                <option value="" disabled selected>Select a Hotel</option>
                <option th:each="hotel : ${hotels}" th:value="${hotel.id}" th:text="${hotel.name}"></option>
            </select>
        </div>
        <div class="form-group">
            <label for="roomNumber">Room Number:</label>
            <select class="form-control" id="roomNumber" th:field="*{roomNumber}" required>
                <option value="" disabled selected>Select a Room</option>
            </select>
        </div>
        <div class="form-group">
            <label for="roomCategory">Room Category:</label>
            <input type="text" class="form-control" id="roomCategory" th:field="*{roomCategory}" required />
        </div>
        <div class="form-group">
            <label for="startDate">Start Date:</label>
            <input type="date" class="form-control" id="startDate" th:field="*{startDate}" required />
        </div>
        <div class="form-group">
            <label for="endDate">End Date:</label>
            <input type="date" class="form-control" id="endDate" th:field="*{endDate}" required />
        </div>

        <button type="submit" class="btn btn-primary">Add Reservation</button>
        <a href="/admin/home" class="btn btn-secondary">Back</a>
    </form>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    function loadRooms() {
        var hotelId = $('#hotel').val();
        $.ajax({
            url: '/admin/getRooms',
            type: 'GET',
            data: {
                hotelId: hotelId
            },
            success: function(rooms) {
                var roomSelect = $('#roomNumber');
                roomSelect.empty();
                roomSelect.append('<option value="" disabled selected>Select a Room</option>');
                rooms.forEach(function(room) {
                    var isDisabled = room.status !== 'AVAILABLE';
                    var optionText = room.roomNumber + ' - ' + room.roomCategory + ' (' + room.status + ')';
                    var optionElement = $('<option>', {
                        value: room.roomNumber,
                        text: optionText,
                        disabled: isDisabled
                    });
                    roomSelect.append(optionElement);
                });
            }
        });
    }
</script>
</body>
</html>
